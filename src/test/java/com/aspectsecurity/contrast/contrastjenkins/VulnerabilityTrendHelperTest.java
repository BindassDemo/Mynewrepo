package com.aspectsecurity.contrast.contrastjenkins;

import com.contrastsecurity.models.Trace;
import com.contrastsecurity.models.Traces;
import junit.framework.TestCase;
import org.junit.Test;

import java.util.ArrayList;
import java.util.List;

import static org.mockito.Mockito.when;
import static org.powermock.api.mockito.PowerMockito.mock;

public class VulnerabilityTrendHelperTest extends TestCase {

    @Test
    public void testGetVulnerabilityInfoString() {
        Trace traceMock = mock(Trace.class);
        when(traceMock.getSeverity()).thenReturn("Medium");

        Trace traceMock2 = mock(Trace.class);
        when(traceMock2.getSeverity()).thenReturn("High");

        List<Trace> traces = new ArrayList<>();
        traces.add(traceMock);
        traces.add(traceMock2);

        Traces tracesMock = mock(Traces.class);
        when(tracesMock.getCount()).thenReturn(2);
        when(tracesMock.getTraces()).thenReturn(traces);

        String info = VulnerabilityTrendHelper.getVulnerabilityInfoString(tracesMock);
        assertEquals("Found vulnerabilities: Medium - 1 High - 1 .", info);
    }

    @Test
    public void testGetVulnerabilityInfoStringEmptyTraces() {

        List<Trace> traces = new ArrayList<>();

        Traces tracesMock = mock(Traces.class);
        when(tracesMock.getCount()).thenReturn(0);
        when(tracesMock.getTraces()).thenReturn(traces);

        String info = VulnerabilityTrendHelper.getVulnerabilityInfoString(tracesMock);
        assertEquals("", info);
    }

    @Test
    public void testGetVulnerabilityInfoStringNullTraces() {

        String info = VulnerabilityTrendHelper.getVulnerabilityInfoString(null);
        assertEquals("", info);
    }
}
