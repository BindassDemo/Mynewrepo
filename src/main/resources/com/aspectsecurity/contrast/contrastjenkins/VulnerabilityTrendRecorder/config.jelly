<?jelly escape-by-default='true'?>
<j:jelly xmlns:j="jelly:core" xmlns:f="/lib/form" xmlns:st="jelly:stapler">

    <f:section title="Vulnerability Threshold Conditions">
        <f:entry title="TeamServer Profile" field="teamServerProfileName">
            <f:select/>
        </f:entry>

        <j:set var="vulnerabilityTrendRecorderInstance" value="${instance}"/>

        <f:entry description="Conditions for verifying your build">
            <f:repeatable field="conditions">
                <table width="100%">
                    <f:entry title="Application Name"
                             help="/plugin/contrast-continuous-application-security/help-applicationName.html">
                        <f:textbox name="applicationName" field="applicationName" default="${it.displayName}"/>
                    </f:entry>

                    <f:entry title="Count" field="thresholdCount"
                             help="/plugin/contrast-continuous-application-security/help-thresholdCount.html">
                        <f:number name="thresholdCount" field="thresholdCount" default="0"
                                  clazz="required positive-number"/>
                    </f:entry>

                    <f:entry title="Severity" field="thresholdSeverity"
                             help="/plugin/contrast-continuous-application-security/help-thresholdSeverity.html">
                        <f:select/>
                    </f:entry>

                    <f:entry title="Vulnerability Type" field="thresholdVulnType"
                             help="/plugin/contrast-continuous-application-security/help-thresholdVulnType.html">
                        <f:select/>
                    </f:entry>

                    <f:entry title="Vulnerability statuses" help="/plugin/contrast-continuous-application-security/help-vulnerabilityStatus.html">
                        <f:checkbox title="Auto-Remediated" name="autoRemediated" field="autoRemediated"/>
                    </f:entry>

                    <f:entry>
                        <f:checkbox title="Not a Problem" name="notAProblem" field="notAProblem"/>
                    </f:entry>
                    <f:entry>
                        <f:checkbox title="Fixed" name="fixed" field="fixed"/>
                    </f:entry>
                    <f:entry>
                        <f:checkbox title="Confirmed" name="confirmed" field="confirmed"/>
                    </f:entry>
                    <f:entry>
                        <f:checkbox title="Remediated" name="remediated" field="remediated"/>
                    </f:entry>
                    <f:entry>
                        <f:checkbox title="Being Tracked" name="beingTracked" field="beingTracked"/>
                    </f:entry>
                    <f:entry>
                        <f:checkbox title="Suspicious" name="suspicious" field="suspicious"/>
                    </f:entry>
                    <f:entry>
                        <f:checkbox title="Reported" name="reported" field="reported"/>
                    </f:entry>
                    <f:entry>
                        <f:checkbox title="Untracked" name="untracked" field="untracked"/>
                    </f:entry>

                    <f:entry title="">
                        <div align="right">
                            <f:repeatableDeleteButton/>
                        </div>
                    </f:entry>
                </table>
            </f:repeatable>
        </f:entry>
    </f:section>
    <script>
        var thresholdCountElements = document.getElementsByName("thresholdCount");
        var thresholdSeverityElements = document.getElementsByName("_.thresholdSeverity");
        var thresholdVulnTypeElements = document.getElementsByName("_.thresholdVulnType");
        var autoRemediatedElements = document.getElementsByName("autoRemediated");
        var notAProblemElements = document.getElementsByName("notAProblem");
        var fixedElements = document.getElementsByName("fixed");
        var confirmedElements = document.getElementsByName("confirmed");
        var remediatedElements = document.getElementsByName("remediated");
        var beingTrackedElements = document.getElementsByName("beingTracked");
        var suspiciousElements = document.getElementsByName("suspicious");
        var reportedElements = document.getElementsByName("reported");
        var untrackedElements = document.getElementsByName("untracked");

        var dynamicElements = [];
        dynamicElements.push(thresholdCountElements);
        dynamicElements.push(thresholdSeverityElements);
        dynamicElements.push(thresholdVulnTypeElements);
        dynamicElements.push(autoRemediatedElements);
        dynamicElements.push(notAProblemElements);
        dynamicElements.push(fixedElements);
        dynamicElements.push(confirmedElements);
        dynamicElements.push(remediatedElements);
        dynamicElements.push(beingTrackedElements);
        dynamicElements.push(suspiciousElements);
        dynamicElements.push(reportedElements);
        dynamicElements.push(untrackedElements);



        var elements = document.getElementsByName("_.teamServerProfileName");
        var teamServerProfileSelect = elements[0];
        teamServerProfileSelect.onchange = function() {isAllowGlobalThresholdConditionsOverride()};

        var obj =
        <st:bind value="${instance}"/>

        function isAllowGlobalThresholdConditionsOverride() {
        obj.isAllowGlobalThresholdConditionsOverride(teamServerProfileSelect.value, function(t){

        if (t.responseObject()) {

        } else {


        }
        console.log(t.responseObject());
        });
        }
    </script>

</j:jelly>